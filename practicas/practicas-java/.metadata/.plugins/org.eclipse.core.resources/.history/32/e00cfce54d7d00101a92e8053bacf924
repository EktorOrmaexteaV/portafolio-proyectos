package com.cajero.gui;

import javax.swing.*;
import java.awt.*;
import java.awt.event.ActionListener;
import java.awt.event.ActionEvent;

import com.cajero.Cajero;

public class Alta {
	Cajero cajero = new Cajero();

	private JFrame frmAlta;
	private JTextField txtID;
	private JTextField txtNombre;
	private JTextField txtApellido;
	private JTextField txtSaldo;
	
	private String cuenta;
    private String PIN;
    private final double MAX_SALDO = cajero.getMontoMaximo();
    
    public Alta() {iniciar();}
    
    private void darDeAlta() {
		String dni = txtID.getText().trim();
		String nombre = txtNombre.getText().trim();
		String apellidos = txtApellido.getText().trim();
		String saldoStr = txtSaldo.getText().trim();
		
		if (dni.isEmpty() || nombre.isEmpty() || apellidos.isEmpty() || saldoStr.isEmpty()) {
			JOptionPane.showMessageDialog(frmAlta, 
					"Todos los campos son obligatorios.",
                    "Datos incompletos",
					JOptionPane.ERROR_MESSAGE);
			return;
		}
		
		if (!dni.matches("\\d{10}")) {
			JOptionPane.showMessageDialog(frmAlta, 
					"DNI/NIE debe tener 10 dígitos.",
					"DNI/NIE inválido",
					JOptionPane.ERROR_MESSAGE);
			return;
		}
		
		try {			
			double saldo = Double.parseDouble(saldoStr);
			if (saldo < 0 || saldo > MAX_SALDO) {
				JOptionPane.showMessageDialog(frmAlta, 
						"El saldo debe ser un número positivo y no superar " + MAX_SALDO + " €.",
						"Saldo inválido",
						JOptionPane.ERROR_MESSAGE);
				return;				
			}
			JOptionPane.showMessageDialog(frmAlta, 
					"Cuenta creada con éxito.\nDNI/NIE: " + dni + "\nNombre: " + nombre + "\nApellidos: " + apellidos + "\nSaldo: " + saldo + " €",
					"Cuenta creada",
					JOptionPane.INFORMATION_MESSAGE);
			cajero.altaCliente(dni, nombre, apellidos, saldoStr);
			//cajero.consultarSaldo(1);
			
			if (cajero.isSesionActiva()) {
				JOptionPane.showMessageDialog(frmAlta, 
						"Cuenta creada y sesión activa.",
						"Éxito",
						JOptionPane.INFORMATION_MESSAGE);
				cuenta = cajero.getCuentaSesion();
				PIN = cajero.getPinSesion();
			} else {
				JOptionPane.showMessageDialog(frmAlta, 
						"Cuenta creada pero no se pudo activar la sesión.",
						"Advertencia",
						JOptionPane.WARNING_MESSAGE);
			}
		} catch (NumberFormatException ex) {
			JOptionPane.showMessageDialog(frmAlta, 
					"Saldo debe ser un número válido.",
					"Saldo inválido",
					JOptionPane.ERROR_MESSAGE);
			return;
		}
		
	}
    
    private void iniciar() {
		frmAlta = new JFrame();
		frmAlta.getContentPane().setBackground(new Color(60, 63, 65));
		frmAlta.getContentPane().setLayout(null);
		
		JPanel panel1 = new JPanel();
		panel1.setBackground(new Color(204, 204, 204));
		panel1.setBounds(50, 100, 500, 400);
		frmAlta.getContentPane().add(panel1);
		panel1.setLayout(null);
		
		JPanel panel = new JPanel();
		panel.setBackground(new Color(60, 63, 65));
		panel.setBounds(50, 75, 400, 250);
		panel1.add(panel);
		panel.setLayout(null);
		
		JLabel lblDninie = new JLabel("DNI/NIE:");
		lblDninie.setForeground(new Color(204, 204, 204));
		lblDninie.setFont(new Font("Dialog", Font.PLAIN, 15));
		lblDninie.setBounds(37, 61, 61, 17);
		panel.add(lblDninie);
		
		txtID = new JTextField();
		txtID.setBounds(109, 60, 279, 21);
		panel.add(txtID);
		txtID.setColumns(10);
		
		JLabel lblNombre = new JLabel("Nombre:");
		lblNombre.setForeground(UIManager.getColor("Button.disabledToolBarBorderBackground"));
		lblNombre.setFont(new Font("Dialog", Font.PLAIN, 15));
		lblNombre.setBounds(37, 94, 61, 17);
		panel.add(lblNombre);
		
		JLabel lblApellido = new JLabel("Apellidos:");
		lblApellido.setForeground(UIManager.getColor("Button.disabledToolBarBorderBackground"));
		lblApellido.setFont(new Font("Dialog", Font.PLAIN, 15));
		lblApellido.setBounds(26, 129, 70, 17);
		panel.add(lblApellido);
		
		JLabel lblSaldo = new JLabel("Saldo:   €");
		lblSaldo.setForeground(UIManager.getColor("Button.disabledToolBarBorderBackground"));
		lblSaldo.setFont(new Font("Dialog", Font.PLAIN, 15));
		lblSaldo.setBounds(37, 162, 70, 17);
		panel.add(lblSaldo);
		
		txtNombre = new JTextField();
		txtNombre.setBounds(109, 93, 279, 21);
		panel.add(txtNombre);
		txtNombre.setColumns(10);
		
		txtApellido = new JTextField();
		txtApellido.setBounds(109, 128, 279, 21);
		panel.add(txtApellido);
		txtApellido.setColumns(10);
		
		txtSaldo = new JTextField();
		txtSaldo.setBounds(109, 161, 142, 21);
		panel.add(txtSaldo);
		txtSaldo.setColumns(10);
		
		JButton btnSalir = new JButton("Salir");
		btnSalir.setForeground(Color.LIGHT_GRAY);
		btnSalir.setBackground(new Color(60, 63, 65));
		btnSalir.setBounds(576, 449, 100, 27);
		frmAlta.getContentPane().add(btnSalir);
		
		JButton btnAlta = new JButton("<html>\n  <div style='text-align: center;'>\n    Ingresar<br>datos\n  </div>\n</html>\n");
		btnAlta.addActionListener(new ActionListener() {
			public void actionPerformed(ActionEvent e) {
				darDeAlta();
//				new VentanaDatos(cuenta, PIN);
//				frmAlta.dispose();
				JOptionPane.showMessageDialog(frmAlta, 
						"Funcionalidad de alta no implementada aún.\n" + 
						"Cliente dado de alta correctamente.",
						"Información",
						JOptionPane.INFORMATION_MESSAGE);
				System.exit(0);
			}
			
		});
		btnAlta.setBounds(576, 264, 100, 50);
		frmAlta.getContentPane().add(btnAlta);
		frmAlta.setBounds(100, 100, 700, 600);
		frmAlta.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
	}
}